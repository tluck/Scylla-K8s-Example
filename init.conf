# change
helmEnabled=false # use helm or kubectl
backupEnabled=true # or false # enable/configure the cluster for backups with ScyllaDB Manager 
minioEnabled=false # or true # enable/deploy Minio for backups (vs native s3)
# for DDB/alternator
enableAlternator=false # true # enable alternator (DynamoDB API)
writeIsolation="only_rmw_uses_lwt" # "unsafe_rmw" "forbid_rmw" "always"  # alternator write isolation level

# use password auth when mTLS is not enabled - username/password: cassandra/cassandra
enableAuth=true # or false # enable password auth - builds a custom configMap
enableTLS=true # use TLS - must enableAuth - builds a custom configMap
mTLS=false # true # will enable mutual mTLS certificate auth instead of user-passwd auth. 
custom_certs=false # true # use custom certs instead of the operator generated ones

# versions
operatorRepository="scylladb"
operatorTag="1.19" #"1.18.1" # "1.17.1"
dbVersion="2025.3.4" # "2025.2.2" # "2025.1.9" 
managerVersion="3.7.0" # "3.5.1"
agentVersion="3.7.0" #"latest" # "3.5.1"

# resource configs
clusterName="scylla" # name of the cluster - must but the same for multi-dc testing
dataCenterName="dc1" # use dc1 and dc2 for multi-dc testing
scyllaNamespace="${clusterName}-${dataCenterName}" # use region1 and region2 for multi-dc testing
scyllaMonitoringNamespace="scylla-monitoring"
scyllaManagerNamespace="scylla-manager"
# for multi-dc testing use with dual k8s clusters use IPs:
# externalSeeds=( 172.31.1.39 172.31.1.185 172.31.1.129 ) #("EXTERNAL-SEED-1" "EXTERNAL-SEED-2" "EXTERNAL-SEED-3") 
# for same k8s cluster multi-dc testing use service names:
scyllaNamespaceDC1="scylla-dc1"
externalSeeds=("${clusterName}-dc1-rack1-0.${scyllaNamespaceDC1}"\
               "${clusterName}-dc1-rack2-0.${scyllaNamespaceDC1}"\
               "${clusterName}-dc1-rack3-0.${scyllaNamespaceDC1}") # add external seed nodes here

# 
nodeServiceType="Headless"     # Headless, ClusterIP,        LoadBalancer
broadcastClientsType="PodIP"   # PodIP,    ServiceClusterIP, ServiceLoadBalancer
broadcastNodesType="PodIP"     # PodIP,    ServiceClusterIP, ServiceLoadBalancer

# # access all in a VPC
# nodeServiceType="ClusterIP"                # Headless, ClusterIP,        LoadBalancer
# broadcastClientsType="PodIP"               # PodIP,    ServiceClusterIP, ServiceLoadBalancer
# broadcastNodesType="ServiceClusterIP"      # PodIP,    ServiceClusterIP, ServiceLoadBalancer

# # multi-VPC
# nodeServiceType="Headless"                 # Headless, ClusterIP,        LoadBalancer
# broadcastClientsType="PodIP"               # PodIP,    ServiceClusterIP, ServiceLoadBalancer
# broadcastNodesType="PodIP"                 # PodIP,    ServiceClusterIP, ServiceLoadBalancer

# # internet
# nodeServiceType="LoadBalancer"              # Headless, ClusterIP,        LoadBalancer
# broadcastClientsType="ServiceLoadBalancerIngress" # PodIP,    ServiceClusterIP, ServiceLoadBalancer
# broadcastNodesType="ClusterIP"              # PodIP,    ServiceClusterIP, ServiceLoadBalancer

# test for suzie
# broadcastClientsType="ServiceLoadBalancerIngress"
# broadcastNodesType="ServiceLoadBalancerIngress"
# nodeServiceType="LoadBalancer"
# ---
# exposeOptions:
#     broadcastOptions:
#       clients:
#         type: ServiceLoadBalancerIngress
#       nodes:
#         type: ServiceLoadBalancerIngress
#     nodeService:
#       type: LoadBalancer

scrape_interval="30s"  # prometheus scrape interval

# general params for resource allocation
waitPeriod="600s" # how long to wait for the cluster to be ready
context=$(kubectl config current-context || true)

# use minio vs native object storage
  if [[ ${minioEnabled} == true ]]; then
    awss3="#awss3"
    minio=""
    s3BucketName="scylla-backups"
  else
    awss3=""
    minio="#minio"
    # Buckets for ScyllaDB Manager Backups
    # in EKS s3 uses the SA for s3 access
    awsRegion="us-west-2"
    s3BucketName="scylla-backups-aws" 
    gcsBucketName="scylla-backups-gke"
  fi

if [[ ${context} == "docker-desktop" ]]; then

  # labels for a common nodepool - both are the same name if using a single nodepool in dev mode
  nodeSelector0="scylla"
  nodeSelector1="scylla"  
  nodeSelector2="scylla"  

  dbCapacity=20Gi
  dbCpuLimit=2
  dbMemoryLimit=2Gi

  managerCpuLimit=500m
  managerMemoryLimit=500Mi

  managerMembers=1
  managerDbCapacity=2Gi
  managerDbCpuLimit=1
  managerDbMemoryLimit=1Gi

  monitoringCapacity=1Gi
else
  singleZone=false # true # use a single zone for testing
  awsRegion="us-west-2"
  gcpRegion="us-west1"
  [[ ${context} == *gke* ]] && gkeServiceAccount=$(gcloud iam service-accounts list --filter="displayName:gke-service-account" --format="value(email)")

  # labels for 2 nodepools - dedicated and non-dedicated
  nodeSelector0="scylla-operator" # nodes for everything except scylladb
  nodeSelector1="scylla"  # nodes dedicated to just scylladb
  nodeSelector2="application" # nodes for applications

  dbCapacity=250Gi
  dbCpuLimit=6
  dbMemoryLimit=24Gi

  managerCpuLimit=1
  managerMemoryLimit=1Gi

  managerMembers=3
  managerDbCapacity=10Gi
  managerDbCpuLimit=2
  managerDbMemoryLimit=4Gi

  monitoringCapacity=10Gi
fi

if [[ ${operatorTag} == "latest" || ${operatorTag} == *1.19* ]]; then
  v19="" 
  v18="#v18 "
else
  v19="#v19 "
  v18=""
fi
